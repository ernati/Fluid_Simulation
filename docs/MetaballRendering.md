# Metaball Rendering Implementation

## 개요
이 구현은 Fluid Simulation 프로젝트에 메타볼(Metaball) 렌더링 기능을 추가한 것입니다. 메타볼은 개별 입자들을 하나의 연속적인 유체 표면으로 시각화하는 기법입니다.

## 주요 구성 요소

### 1. MetaballRenderer 클래스
- **위치**: `MetaballRenderer.h`, `MetaballRenderer.cpp`
- **기능**: 
  - 입자 위치로부터 스칼라 필드 생성
  - Marching Squares 알고리즘을 사용한 등면(isosurface) 생성
  - OpenGL 렌더링을 위한 메시 데이터 관리

### 2. 주요 매개변수
- `METABALL_THRESHOLD`: 등면 생성 임계값 (기본값: 1.0)
- `GRID_RESOLUTION`: 그리드 해상도 (기본값: 128)
- `METABALL_RADIUS`: 입자 영향 반경 (기본값: 0.1)
- `METABALL_STRENGTH`: 필드 강도 (기본값: 1.0)

### 3. 새로운 기능
- **메타볼 모드**: 'M' 키 또는 우클릭 메뉴로 전환 가능
- **실시간 업데이트**: 입자 시뮬레이션과 동기화된 표면 생성
- **시각적 표현**: 와이어프레임으로 유체 표면 윤곽 표시

## 사용법

### 1. 컴파일 및 실행
- 프로젝트를 빌드하면 새로운 파일들이 자동으로 포함됩니다
- 기존 시뮬레이션과 동일하게 실행됩니다

### 2. 메타볼 모드 활성화
- **키보드**: 'M' 키를 눌러 메타볼 모드 토글
- **메뉴**: 우클릭 → "MetaballMode" 선택

### 3. 시뮬레이션 시작
- "Start" 메뉴 선택 또는 해당하는 메뉴 옵션 사용
- 입자들이 움직이면 메타볼 표면도 실시간으로 업데이트됩니다

## 기술적 세부사항

### Marching Squares 알고리즘
- 2D 공간에서 등면 생성을 위한 표준 알고리즘
- 각 그리드 셀에서 스칼라 값을 기반으로 표면 경계 계산
- 16가지 구성 패턴을 사용하여 삼각형 메시 생성

### 스칼라 필드 계산
```cpp
float influence = strength * radius * radius / (distance * distance);
```
- 역제곱 감쇠를 사용한 메타볼 필드
- 각 입자의 영향력을 거리에 따라 계산

### OpenGL 통합
- 별도의 VAO/VBO를 사용하여 메타볼 메시 관리
- 기존 입자 렌더링과 독립적으로 동작
- 와이어프레임 모드로 표면 윤곽 강조

## 성능 최적화

### 1. 적응적 그리드
- 필요에 따라 그리드 해상도 조정 가능
- 메모리 사용량과 품질 간의 균형

### 2. 조건부 업데이트
- 입자 데이터 변경 시에만 메시 재생성
- 불필요한 계산 최소화

### 3. GPU 친화적 데이터 구조
- 연속된 메모리 레이아웃
- 효율적인 버퍼 업데이트

## 확장 가능성

### 1. 3D 확장
- Marching Cubes 알고리즘으로 업그레이드
- 볼륨 렌더링 지원

### 2. 고급 시각 효과
- 법선 벡터 계산으로 조명 효과
- 텍스처 매핑 지원
- 반투명 렌더링

### 3. 성능 향상
- GPU 컴퓨트 셰이더 활용
- 병렬 처리 최적화
- 적응적 세분화

## 매개변수 조정 가이드

### threshold (임계값)
- **낮은 값 (0.3-0.7)**: 더 매끄러운 표면, 입자들이 더 쉽게 연결
- **높은 값 (1.0-2.0)**: 더 날카로운 표면, 개별 입자 구분 가능

### radius (반경)
- **작은 값 (0.05-0.1)**: 세밀한 디테일, 개별 입자 영향 제한
- **큰 값 (0.15-0.3)**: 부드러운 병합, 넓은 영향 범위

### strength (강도)
- **낮은 값 (0.5-1.0)**: 약한 필드, 희박한 연결
- **높은 값 (1.5-3.0)**: 강한 필드, 강력한 병합 효과

## 디버깅 및 문제 해결

### 일반적인 문제
1. **표면이 나타나지 않음**: threshold 값이 너무 높음
2. **과도하게 연결된 표면**: radius나 strength 값이 너무 큼
3. **성능 저하**: grid resolution이 너무 높음

### 디버깅 팁
- 콘솔 출력으로 메타볼 모드 상태 확인
- 그리드 해상도를 낮춰서 성능 테스트
- 매개변수를 점진적으로 조정